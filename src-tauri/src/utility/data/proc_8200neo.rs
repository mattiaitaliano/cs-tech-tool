use std::process::Command;
use std::os::windows::process::CommandExt;

const CREATE_NO_WINDOW: u32 = 0x08000000;
////////////////////////////////////////////////////
///////////////////// 82000 NEO ////////////////////
////////////////////////////////////////////////////


pub async fn cs8200neo_defender(action: String) {
    let paths = vec![
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\AcqConfigEditor.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\acquisition.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\AcquisitionSampleAdvanced.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\acq_process20_x64.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\acq_process_Win32.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\acq_process_x64.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\hostwx.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\UninstallAcqNetConfig.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\UninstallAcquisitionGui_Syracuse.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\Uninstall_CS82003D.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\DeviceStateAgent\\UninstallDeviceStateAgent_Radiology.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\DeviceStateAgent\\Radiology\\Application\\DeviceStateAgent.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\GUIServer\\GuiServer.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\GUIServer\\HkcuRegkeyAccess.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\GUIServer\\UninstallGuiServerSyracuseV2.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\GUIServerService\\GUIServerService.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\GUIServerService\\Uninstall_SetupGUIServerSyracuseV2Service.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\Licensing\\uninstall_LicensingCore.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\NagoyaWebView\\Nagoya_WebView.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\NagoyaWebView\\Uninstall_NagoyaWebView.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\nginx\\nginx.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\nginx\\NginxParserConf.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\NGinxService\\NGinxService.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\NGinxService\\Uninstall_SetupNGinxService.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\PluginBackEnds\\AcqSyracuseBackEnd\\Configure.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\PluginBackEnds\\AcqSyracuseBackEnd\\UninstallDriverSyracuseBackEnd.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\Plugins\\AcqPluginIOScan\\Uninstall_AcqPluginIOScan.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\Plugins\\AcqSyracuse\\Configure.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\Plugins\\AcqSyracuse\\Uninstall_DriverSyracuse.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\WSSurveyServer\\UninstallWSSurveyServer.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\WSSurveyServer\\WSSurveyServer.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\WSSurveyService\\Uninstall_SetupWSSurveyService_Syracuse.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\WSSurveyService\\WSSurveyReport.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Acquisition\\WSSurveyService\\WSSurveyService.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\AEC\\aec.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\AEC\\CreatesListProjectionMatricesFromDCM.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\AEC\\EXE_CreateListProjectionMatrices.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\AEC\\vcredist2013_x64.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\AEC\\vcredist_x64.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\AEC\\VC_redist.x64.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\AEC\\SFR\\sfr_command.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\AEC\\SFR\\bin\\win32\\sfr2.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\AEC\\SFR\\bin\\win32\\sfrc.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\AEC\\SFR\\bin\\win32\\sfr_command.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\AutoStart.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWUninstall.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\Etk.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\Install.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\PP_Update.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\Uninstall_CS8200EParts.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\h2\\service\\wrapper.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\jabswitch.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\java-rmi.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\java.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\javacpl.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\javaw.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\javaws.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\jjs.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\jp2launcher.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\keytool.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\kinit.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\klist.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\ktab.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\orbd.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\pack200.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\policytool.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\rmid.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\rmiregistry.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\servertool.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\ssvagent.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\tnameserv.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\32\\bin\\unpack200.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\jabswitch.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\java-rmi.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\java.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\javacpl.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\javaw.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\javaws.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\jjs.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\jp2launcher.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\keytool.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\kinit.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\klist.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\ktab.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\orbd.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\pack200.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\policytool.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\rmid.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\rmiregistry.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\servertool.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\ssvagent.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\tnameserv.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\CS8200 eParts\\DWJava\\Java8u131\\64\\bin\\unpack200.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\EquipmentTools\\UninstallEquipmentTools_CS8200.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\EquipmentTools\\CS8200\\Application\\EquipmentTools.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\EquipmentTools\\CS8200\\Application\\IQTools\\SFR\\sfr_command.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\EquipmentTools\\CS8200\\Application\\IQTools\\SFR\\bin\\win32\\sfr2.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\EquipmentTools\\CS8200\\Application\\IQTools\\SFR\\bin\\win32\\sfrc.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\EquipmentTools\\CS8200\\Application\\IQTools\\SFR\\bin\\win32\\sfr_command.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\EquipmentTools\\CS8200\\Commons\\XMLTransform\\xsltproc.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Services\\AcqNetConfService.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Services\\TaskQueue\\Sample.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Services\\TaskQueue\\TaskQueuePanel.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Services\\TaskQueue\\TaskQueuePluginProcess.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Services\\TaskQueue\\TaskQueueServer.exe", 
        "C:\\Program Files\\Common Files\\Trophy\\Services\\TaskQueue\\Tools\\CudaInfo.exe", 
    ];

    for path in paths.iter() {
        let command = match action.to_lowercase().as_str() {
            "add" => format!(r#"Add-MpPreference -ExclusionPath "{}""#, path),
            "remove" => format!(r#"Remove-MpPreference -ExclusionPath "{}""#, path),
            _ => continue,
        };
        Command::new("powershell")
            .args(&["-Command", &command])
            .creation_flags(CREATE_NO_WINDOW)
            .output()
            .expect("failed to execute process");

    }
}
